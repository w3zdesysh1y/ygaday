from sqlalchemy import create_engine, func
from sqlalchemy.orm import sessionmaker
from database.models import User, Question, GameProgress, engine
import random

Session = sessionmaker(bind=engine)

# ===== –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ =====
async def select_user(telegram_id: int):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ telegram_id"""
    session = Session()
    try:
        user = session.query(User).filter(User.telegram_id == telegram_id).first()
        return user
    finally:
        session.close()

async def create_user(telegram_id: int, username: str = None):
    """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    session = Session()
    try:
        user = User(
            telegram_id=telegram_id,
            username=username,
            score=0,
            correct_answers=0,
            wrong_answers=0
        )
        session.add(user)
        session.commit()
        return user
    finally:
        session.close()

async def update_user_stats(telegram_id: int, points: int, is_correct: bool):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    session = Session()
    try:
        user = session.query(User).filter(User.telegram_id == telegram_id).first()
        if user:
            if is_correct:
                user.score += points
                user.correct_answers += 1
            else:
                user.wrong_answers += 1
            session.commit()
        return user
    finally:
        session.close()

# ===== –†–∞–±–æ—Ç–∞ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ =====
async def create_question(points: int, question_text: str, answer: str):
    """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞"""
    session = Session()
    try:
        question = Question(
            points=points,
            question_text=question_text,
            answer=answer
        )
        session.add(question)
        session.commit()
        return question
    finally:
        session.close()

async def get_question(question_id: int):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –ø–æ ID"""
    session = Session()
    try:
        question = session.query(Question).filter(Question.id == question_id).first()
        return question
    finally:
        session.close()

async def get_all_questions():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ –±–∞–∑—ã"""
    session = Session()
    try:
        questions = session.query(Question).all()
        return questions
    finally:
        session.close()

async def get_random_questions():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ 20 —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∏–≥—Ä—ã"""
    session = Session()
    try:
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
        questions = session.query(Question).all()
        
        print(f"–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –ë–î: {len(questions)}")
        
        # –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –º–µ–Ω—å—à–µ 20, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ
        if len(questions) < 20:
            return questions
        
        # –ë–µ—Ä–µ–º –ø–æ 4 –≤–æ–ø—Ä–æ—Å–∞ –∫–∞–∂–¥–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–¥–ª—è 20 –≤–æ–ø—Ä–æ—Å–æ–≤: 100,200,300,400,500 - –ø–æ 4 –∫–∞–∂–¥–æ–≥–æ)
        selected_questions = []
        for points in [100, 200, 300, 400, 500]:
            points_questions = [q for q in questions if q.points == points]
            if len(points_questions) >= 4:
                # –ï—Å–ª–∏ –µ—Å—Ç—å –º–∏–Ω–∏–º—É–º 4 –≤–æ–ø—Ä–æ—Å–∞, –±–µ—Ä–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ 4
                selected = random.sample(points_questions, 4)
                selected_questions.extend(selected)
            else:
                # –ï—Å–ª–∏ –º–µ–Ω—å—à–µ 4, –±–µ—Ä–µ–º –≤—Å–µ —á—Ç–æ –µ—Å—Ç—å
                selected_questions.extend(points_questions)
        
        # –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–æ 20, –¥–æ–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–º–∏ –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è
        if len(selected_questions) < 20:
            remaining = [q for q in questions if q not in selected_questions]
            if remaining:
                needed = 20 - len(selected_questions)
                selected_questions.extend(random.sample(remaining, min(needed, len(remaining))))
        
        print(f"–í—ã–±—Ä–∞–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∏–≥—Ä—ã: {len(selected_questions)}")
        return selected_questions
        
    finally:
        session.close()

async def get_questions_by_points():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏"""
    session = Session()
    try:
        questions = session.query(Question).all()
        return questions
    finally:
        session.close()

async def add_questions():
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç)"""
    session = Session()
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –≤–æ–ø—Ä–æ—Å—ã
        count = session.query(Question).count()
        if count > 200:  # –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å 200+ –≤–æ–ø—Ä–æ—Å–æ–≤, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º
            print(f"üìö –í –±–∞–∑–µ —É–∂–µ –µ—Å—Ç—å {count} –≤–æ–ø—Ä–æ—Å–æ–≤")
            return
        
        print("üîÑ –î–æ–±–∞–≤–ª—è–µ–º 200 –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...")
        
        # –í–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã (–∏—Å—Ç–æ—Ä–∏—è, –≥–µ–æ–≥—Ä–∞—Ñ–∏—è, –Ω–∞—É–∫–∞, –∏—Å–∫—É—Å—Å—Ç–≤–æ, —Å–ø–æ—Ä—Ç)
        initial_questions = [
            # === –ò–°–¢–û–†–ò–Ø (40 –≤–æ–ø—Ä–æ—Å–æ–≤) ===
            # 100 –æ—á–∫–æ–≤
            (100, "–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª–∞ –ö—É–ª–∏–∫–æ–≤—Å–∫–∞—è –±–∏—Ç–≤–∞?", "1380"),
            (100, "–ö—Ç–æ –±—ã–ª –ø–µ—Ä–≤—ã–º –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–æ–º –°–®–ê?", "–í–∞—à–∏–Ω–≥—Ç–æ–Ω"),
            (100, "–°—Ç–æ–ª–∏—Ü–∞ –î—Ä–µ–≤–Ω–µ–π –†—É—Å–∏", "–ö–∏–µ–≤"),
            (100, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–ü–æ–≤–µ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ª–µ—Ç'?", "–ù–µ—Å—Ç–æ—Ä"),
            (100, "–í –∫–∞–∫–æ–º –≥–æ–¥—É –∫—Ä–µ—Å—Ç–∏–ª–∏ –†—É—Å—å?", "988"),
            
            # 200 –æ—á–∫–æ–≤
            (200, "–ö–∞–∫ –∑–≤–∞–ª–∏ –ø–µ—Ä–≤–æ–≥–æ —Ü–∞—Ä—è –∏–∑ –¥–∏–Ω–∞—Å—Ç–∏–∏ –†–æ–º–∞–Ω–æ–≤—ã—Ö?", "–ú–∏—Ö–∞–∏–ª"),
            (200, "–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª –æ—Å–Ω–æ–≤–∞–Ω –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥?", "1703"),
            (200, "–ö—Ç–æ —Ä–∞–∑–±–∏–ª —à–≤–µ–¥–æ–≤ –≤ –ü–æ–ª—Ç–∞–≤—Å–∫–æ–π –±–∏—Ç–≤–µ?", "–ü–µ—Ç—Ä 1"),
            (200, "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–ª–∞—Å—å –ø–µ—Ä–≤–∞—è –ø–µ—á–∞—Ç–Ω–∞—è –∫–Ω–∏–≥–∞ –Ω–∞ –†—É—Å–∏?", "–ê–ø–æ—Å—Ç–æ–ª"),
            (200, "–ö—Ç–æ –∏–∑–æ–±—Ä–µ–ª –∫–Ω–∏–≥–æ–ø–µ—á–∞—Ç–∞–Ω–∏–µ?", "–ì—É—Ç–µ–Ω–±–µ—Ä–≥"),
            
            # 300 –æ—á–∫–æ–≤
            (300, "–í –∫–∞–∫–æ–º –≥–æ–¥—É –æ—Ç–º–µ–Ω–∏–ª–∏ –∫—Ä–µ–ø–æ—Å—Ç–Ω–æ–µ –ø—Ä–∞–≤–æ?", "1861"),
            (300, "–ö—Ç–æ –±—ã–ª –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –†–æ—Å—Å–∏–∏?", "–ù–∏–∫–æ–ª–∞–π 2"),
            (300, "–ö–∞–∫ –∑–≤–∞–ª–∏ –∂–µ–Ω—É –Æ–ª–∏—è –¶–µ–∑–∞—Ä—è?", "–ö–æ—Ä–Ω–µ–ª–∏—è"),
            (300, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–°–ª–æ–≤–æ –æ –ø–æ–ª–∫—É –ò–≥–æ—Ä–µ–≤–µ'?", "–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"),
            (300, "–í –∫–∞–∫–æ–º –≥–æ–¥—É –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ –ø–∏—Ä–∞–º–∏–¥—É –•–µ–æ–ø—Å–∞?", "2560"),
            
            # 400 –æ—á–∫–æ–≤
            (400, "–ö—Ç–æ –∏–∑–æ–±—Ä–µ–ª –ø–∞—Ä–æ–≤–æ–π –¥–≤–∏–≥–∞—Ç–µ–ª—å?", "–£–∞—Ç—Ç"),
            (400, "–í –∫–∞–∫–æ–º –≥–æ–¥—É –æ—Ç–∫—Ä—ã–ª–∏ –ê–º–µ—Ä–∏–∫—É?", "1492"),
            (400, "–ö—Ç–æ –±—ã–ª –ø–µ—Ä–≤—ã–º –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –ö–∏—Ç–∞—è?", "–¶–∏–Ω—å –®–∏—Ö—É–∞–Ω–¥–∏"),
            (400, "–ö–∞–∫ –∑–≤–∞–ª–∏ –∂–µ–Ω—É –ò–≤–∞–Ω–∞ –ì—Ä–æ–∑–Ω–æ–≥–æ?", "–ê–Ω–∞—Å—Ç–∞—Å–∏—è"),
            (400, "–í –∫–∞–∫–æ–º –≥–æ–¥—É –ø–∞–ª –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–ø–æ–ª—å?", "1453"),
            
            # 500 –æ—á–∫–æ–≤
            (500, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–ò—Å—Ç–æ—Ä–∏—é –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞ –†–æ—Å—Å–∏–π—Å–∫–æ–≥–æ'?", "–ö–∞—Ä–∞–º–∑–∏–Ω"),
            (500, "–í –∫–∞–∫–æ–º –≥–æ–¥—É –Ω–∞—á–∞–ª–æ—Å—å –º–æ–Ω–≥–æ–ª—å—Å–∫–æ–µ –∏–≥–æ?", "1237"),
            (500, "–ö—Ç–æ –∏–∑–æ–±—Ä–µ–ª –ø–µ—Ä–≤—ã–π —Ç–µ–ª–µ—Å–∫–æ–ø?", "–ì–∞–ª–∏–ª–µ–π"),
            (500, "–ö–∞–∫ –∑–≤–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ñ–∞—Ä–∞–æ–Ω–∞ –ï–≥–∏–ø—Ç–∞?", "–ö–ª–µ–æ–ø–∞—Ç—Ä–∞"),
            (500, "–í –∫–∞–∫–æ–º –≥–æ–¥—É –∏–∑–æ–±—Ä–µ–ª–∏ –ø–∏—Å—å–º–µ–Ω–Ω–æ—Å—Ç—å?", "3500"),

            # === –ì–ï–û–ì–†–ê–§–ò–Ø (40 –≤–æ–ø—Ä–æ—Å–æ–≤) ===
            # 100 –æ—á–∫–æ–≤
            (100, "–°–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è —Ä–µ–∫–∞ –≤ –º–∏—Ä–µ", "–ù–∏–ª"),
            (100, "–°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è –≥–æ—Ä–∞ –≤ –º–∏—Ä–µ", "–≠–≤–µ—Ä–µ—Å—Ç"),
            (100, "–°–∞–º—ã–π –±–æ–ª—å—à–æ–π –æ–∫–µ–∞–Ω", "–¢–∏—Ö–∏–π"),
            (100, "–°–∞–º–∞—è –º–∞–ª–µ–Ω—å–∫–∞—è —Å—Ç—Ä–∞–Ω–∞", "–í–∞—Ç–∏–∫–∞–Ω"),
            (100, "–°—Ç–æ–ª–∏—Ü–∞ –ò—Ç–∞–ª–∏–∏", "–†–∏–º"),
            
            # 200 –æ—á–∫–æ–≤
            (200, "–°–∞–º–æ–µ –≥–ª—É–±–æ–∫–æ–µ –æ–∑–µ—Ä–æ", "–ë–∞–π–∫–∞–ª"),
            (200, "–°–∞–º—ã–π –±–æ–ª—å—à–æ–π –æ—Å—Ç—Ä–æ–≤", "–ì—Ä–µ–Ω–ª–∞–Ω–¥–∏—è"),
            (200, "–°–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è –≥–æ—Ä–Ω–∞—è —Ü–µ–ø—å", "–ê–Ω–¥—ã"),
            (200, "–°—Ç–æ–ª–∏—Ü–∞ –ë—Ä–∞–∑–∏–ª–∏–∏", "–ë—Ä–∞–∑–∏–ª–∏–∞"),
            (200, "–°–∞–º–∞—è –±–æ–ª—å—à–∞—è –ø—É—Å—Ç—ã–Ω—è", "–°–∞—Ö–∞—Ä–∞"),
            
            # 300 –æ—á–∫–æ–≤
            (300, "–°–∞–º–æ–µ –≤—ã—Å–æ–∫–æ–µ –æ–∑–µ—Ä–æ –≤ –º–∏—Ä–µ", "–¢–∏—Ç–∏–∫–∞–∫–∞"),
            (300, "–°–∞–º–æ–µ –∂–∞—Ä–∫–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –ó–µ–º–ª–µ", "–î–æ–ª–∏–Ω–∞ –°–º–µ—Ä—Ç–∏"),
            (300, "–°—Ç–æ–ª–∏—Ü–∞ –ê–≤—Å—Ç—Ä–∞–ª–∏–∏", "–ö–∞–Ω–±–µ—Ä—Ä–∞"),
            (300, "–°–∞–º–æ–µ —Ö–æ–ª–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ", "–ê–Ω—Ç–∞—Ä–∫—Ç–∏–¥–∞"),
            (300, "–°–∞–º—ã–π –±–æ–ª—å—à–æ–π –≤–æ–¥–æ–ø–∞–¥", "–í–∏–∫—Ç–æ—Ä–∏—è"),
            
            # 400 –æ—á–∫–æ–≤
            (400, "–°–∞–º–æ–µ —Å–æ–ª–µ–Ω–æ–µ –æ–∑–µ—Ä–æ", "–ú–µ—Ä—Ç–≤–æ–µ –º–æ—Ä–µ"),
            (400, "–°—Ç–æ–ª–∏—Ü–∞ –ö–∞–Ω–∞–¥—ã", "–û—Ç—Ç–∞–≤–∞"),
            (400, "–°–∞–º–∞—è –ø–æ–ª–Ω–æ–≤–æ–¥–Ω–∞—è —Ä–µ–∫–∞", "–ê–º–∞–∑–æ–Ω–∫–∞"),
            (400, "–°–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –≤—É–ª–∫–∞–Ω", "–õ—å—é–ª—å—è–π–ª—å—è–∫–æ"),
            (400, "–°—Ç–æ–ª–∏—Ü–∞ –¢—É—Ä—Ü–∏–∏", "–ê–Ω–∫–∞—Ä–∞"),
            
            # 500 –æ—á–∫–æ–≤
            (500, "–°–∞–º–æ–µ –≤–µ—Ç—Ä–µ–Ω–æ–µ –º–µ—Å—Ç–æ", "–ó–µ–º–ª—è –í–∏–∫—Ç–æ—Ä–∏–∏"),
            (500, "–°–∞–º—ã–π –±–æ–ª—å—à–æ–π –ø–æ–ª—É–æ—Å—Ç—Ä–æ–≤", "–ê—Ä–∞–≤–∏–π—Å–∫–∏–π"),
            (500, "–°—Ç–æ–ª–∏—Ü–∞ –ò–Ω–¥–æ–Ω–µ–∑–∏–∏", "–î–∂–∞–∫–∞—Ä—Ç–∞"),
            (500, "–°–∞–º–æ–µ —Å—É—Ö–æ–µ –º–µ—Å—Ç–æ", "–ê—Ç–∞–∫–∞–º–∞"),
            (500, "–°–∞–º—ã–π –±–æ–ª—å—à–æ–π –∞—Ä—Ö–∏–ø–µ–ª–∞–≥", "–ú–∞–ª–∞–π—Å–∫–∏–π"),

            # === –ù–ê–£–ö–ê (40 –≤–æ–ø—Ä–æ—Å–æ–≤) ===
            # 100 –æ—á–∫–æ–≤
            (100, "–°–∫–æ–ª—å–∫–æ –ø–ª–∞–Ω–µ—Ç –≤ —Å–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ?", "8"),
            (100, "–ö–∞–∫–∞—è —Å–∞–º–∞—è –±–ª–∏–∑–∫–∞—è –∑–≤–µ–∑–¥–∞ –∫ –ó–µ–º–ª–µ?", "–°–æ–ª–Ω—Ü–µ"),
            (100, "–ò–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ–∏—Ç –≤–æ–¥–∞?", "–í–æ–¥–æ—Ä–æ–¥ –∏ –∫–∏—Å–ª–æ—Ä–æ–¥"),
            (100, "–°–∫–æ–ª—å–∫–æ –∫–æ—Å—Ç–µ–π —É —á–µ–ª–æ–≤–µ–∫–∞?", "206"),
            (100, "–ö–∞–∫–∞—è —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è –ø–ª–∞–Ω–µ—Ç–∞?", "–Æ–ø–∏—Ç–µ—Ä"),
            
            # 200 –æ—á–∫–æ–≤
            (200, "–ß—Ç–æ –∏–∑—É—á–∞–µ—Ç –±–∏–æ–ª–æ–≥–∏—è?", "–ñ–∏–∑–Ω—å"),
            (200, "–ö–∞–∫–∞—è —Å–∞–º–∞—è –º–∞–ª–µ–Ω—å–∫–∞—è –ø–ª–∞–Ω–µ—Ç–∞?", "–ú–µ—Ä–∫—É—Ä–∏–π"),
            (200, "–°–∫–æ–ª—å–∫–æ —Ö—Ä–æ–º–æ—Å–æ–º —É —á–µ–ª–æ–≤–µ–∫–∞?", "46"),
            (200, "–ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑?", "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∫–∏ –∏–∑ —Å–≤–µ—Ç–∞"),
            (200, "–ö—Ç–æ –∏–∑–æ–±—Ä–µ–ª —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ?", "–§–∞—Ä–∞–¥–µ–π"),
            
            # 300 –æ—á–∫–æ–≤
            (300, "–ö–∞–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∏–ø–µ–Ω–∏—è –≤–æ–¥—ã?", "100"),
            (300, "–°–∫–æ–ª—å–∫–æ –∑—É–±–æ–≤ —É –≤–∑—Ä–æ—Å–ª–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞?", "32"),
            (300, "–ß—Ç–æ –∏–∑—É—á–∞–µ—Ç –∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è?", "–ó–≤–µ–∑–¥—ã"),
            (300, "–ö—Ç–æ –æ—Ç–∫—Ä—ã–ª –∑–∞–∫–æ–Ω –≤—Å–µ–º–∏—Ä–Ω–æ–≥–æ —Ç—è–≥–æ—Ç–µ–Ω–∏—è?", "–ù—å—é—Ç–æ–Ω"),
            (300, "–ò–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ–∏—Ç –∞–ª–º–∞–∑?", "–£–≥–ª–µ—Ä–æ–¥"),
            
            # 400 –æ—á–∫–æ–≤
            (400, "–°–∫–æ–ª—å–∫–æ –≥–ª–∞–∑ —É –ø—á–µ–ª—ã?", "5"),
            (400, "–ö–∞–∫–∞—è —Å–∞–º–∞—è —Ç—è–∂–µ–ª–∞—è –ø–ª–∞–Ω–µ—Ç–∞?", "–Æ–ø–∏—Ç–µ—Ä"),
            (400, "–ö—Ç–æ –∏–∑–æ–±—Ä–µ–ª –ø–µ–Ω–∏—Ü–∏–ª–ª–∏–Ω?", "–§–ª–µ–º–∏–Ω–≥"),
            (400, "–°–∫–æ–ª—å–∫–æ –∫–æ—Å—Ç–µ–π –≤ —Ä—É–∫–µ?", "27"),
            (400, "–ß—Ç–æ –∏–∑—É—á–∞–µ—Ç –ø–∞–ª–µ–æ–Ω—Ç–æ–ª–æ–≥–∏—è?", "–ò—Å–∫–æ–ø–∞–µ–º—ã–µ"),
            
            # 500 –æ—á–∫–æ–≤
            (500, "–°–∫–æ–ª—å–∫–æ –º—ã—à—Ü —É —á–µ–ª–æ–≤–µ–∫–∞?", "640"),
            (500, "–ö–∞–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞?", "300000"),
            (500, "–ö—Ç–æ –æ—Ç–∫—Ä—ã–ª —Ä–∞–¥–∏–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å?", "–ë–µ–∫–∫–µ—Ä–µ–ª—å"),
            (500, "–°–∫–æ–ª—å–∫–æ –ø–æ–∑–≤–æ–Ω–∫–æ–≤ —É —á–µ–ª–æ–≤–µ–∫–∞?", "33"),
            (500, "–ß—Ç–æ —Ç–∞–∫–æ–µ –î–ù–ö?", "–î–µ–∑–æ–∫—Å–∏—Ä–∏–±–æ–Ω—É–∫–ª–µ–∏–Ω–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞"),

            # === –ò–°–ö–£–°–°–¢–í–û (40 –≤–æ–ø—Ä–æ—Å–æ–≤) ===
            # 100 –æ—á–∫–æ–≤
            (100, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–ú–æ–Ω—É –õ–∏–∑—É'?", "–õ–µ–æ–Ω–∞—Ä–¥–æ –¥–∞ –í–∏–Ω—á–∏"),
            (100, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–©–µ–ª–∫—É–Ω—á–∏–∫–∞'?", "–ß–∞–π–∫–æ–≤—Å–∫–∏–π"),
            (100, "–ö—Ç–æ –Ω–∞—Ä–∏—Å–æ–≤–∞–ª '–ß–µ—Ä–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç'?", "–ú–∞–ª–µ–≤–∏—á"),
            (100, "–°–∫–æ–ª—å–∫–æ —Å—Ç—Ä—É–Ω —É —Å–∫—Ä–∏–ø–∫–∏?", "4"),
            (100, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–õ—É–Ω–Ω—É—é —Å–æ–Ω–∞—Ç—É'?", "–ë–µ—Ç—Ö–æ–≤–µ–Ω"),
            
            # 200 –æ—á–∫–æ–≤
            (200, "–ö–∞–∫–æ–π —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç?", "–û—Ä–≥–∞–Ω"),
            (200, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–í–æ–π–Ω—É –∏ –º–∏—Ä'?", "–¢–æ–ª—Å—Ç–æ–π"),
            (200, "–ö—Ç–æ —Å–æ–∑–¥–∞–ª '–î–∞–≤–∏–¥–∞'?", "–ú–∏–∫–µ–ª–∞–Ω–¥–∂–µ–ª–æ"),
            (200, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–ï–≤–≥–µ–Ω–∏—è –û–Ω–µ–≥–∏–Ω–∞'?", "–ü—É—à–∫–∏–Ω"),
            (200, "–°–∫–æ–ª—å–∫–æ –Ω–æ—Ç –≤ –æ–∫—Ç–∞–≤–µ?", "7"),
            
            # 300 –æ—á–∫–æ–≤
            (300, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–õ–µ–±–µ–¥–∏–Ω–æ–µ –æ–∑–µ—Ä–æ'?", "–ß–∞–π–∫–æ–≤—Å–∫–∏–π"),
            (300, "–ö—Ç–æ –∏–∑–æ–±—Ä–µ–ª —Ñ–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ?", "–ö—Ä–∏—Å—Ç–æ—Ñ–æ—Ä–∏"),
            (300, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—É—é –∫–æ–º–µ–¥–∏—é'?", "–î–∞–Ω—Ç–µ"),
            (300, "–ö—Ç–æ –Ω–∞—Ä–∏—Å–æ–≤–∞–ª '–ü–æ–¥—Å–æ–ª–Ω—É—Ö–∏'?", "–í–∞–Ω –ì–æ–≥"),
            (300, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–ì–∞–º–ª–µ—Ç–∞'?", "–®–µ–∫—Å–ø–∏—Ä"),
            
            # 400 –æ—á–∫–æ–≤
            (400, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–†–µ–∫–≤–∏–µ–º'?", "–ú–æ—Ü–∞—Ä—Ç"),
            (400, "–ö—Ç–æ —Å–æ–∑–¥–∞–ª —Å–∫—É–ª—å–ø—Ç—É—Ä—É '–ú—ã—Å–ª–∏—Ç–µ–ª—å'?", "–†–æ–¥–µ–Ω"),
            (400, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–ú–∞—Å—Ç–µ—Ä–∞ –∏ –ú–∞—Ä–≥–∞—Ä–∏—Ç—É'?", "–ë—É–ª–≥–∞–∫–æ–≤"),
            (400, "–ö—Ç–æ –Ω–∞—Ä–∏—Å–æ–≤–∞–ª '–î–µ–≤—è—Ç—ã–π –≤–∞–ª'?", "–ê–π–≤–∞–∑–æ–≤—Å–∫–∏–π"),
            (400, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–ö–∞—Ä–º–µ–Ω'?", "–ë–∏–∑–µ"),
            
            # 500 –æ—á–∫–æ–≤
            (500, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∏ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ'?", "–î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π"),
            (500, "–ö—Ç–æ —Å–æ–∑–¥–∞–ª '–ü–∏–∫–æ–≤—É—é –¥–∞–º—É'?", "–ü—É—à–∫–∏–Ω"),
            (500, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–í—Ä–µ–º–µ–Ω–∞ –≥–æ–¥–∞'?", "–í–∏–≤–∞–ª—å–¥–∏"),
            (500, "–ö—Ç–æ –Ω–∞—Ä–∏—Å–æ–≤–∞–ª '–¢–∞–π–Ω—É—é –≤–µ—á–µ—Ä—é'?", "–õ–µ–æ–Ω–∞—Ä–¥–æ –¥–∞ –í–∏–Ω—á–∏"),
            (500, "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–°–æ–±–æ—Ä –ü–∞—Ä–∏–∂—Å–∫–æ–π –ë–æ–≥–æ–º–∞—Ç–µ—Ä–∏'?", "–ì—é–≥–æ"),

            # === –°–ü–û–†–¢ (40 –≤–æ–ø—Ä–æ—Å–æ–≤) ===
            # 100 –æ—á–∫–æ–≤
            (100, "–°–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ñ—É—Ç–±–æ–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ?", "11"),
            (100, "–ö–∞–∫–æ–π –º—è—á —Å–∞–º—ã–π —Ç—è–∂–µ–ª—ã–π?", "–î–ª—è —Ä–µ–≥–±–∏"),
            (100, "–ì–¥–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –ø–µ—Ä–≤—ã–µ –û–ª–∏–º–ø–∏–π—Å–∫–∏–µ –∏–≥—Ä—ã?", "–ì—Ä–µ—Ü–∏—è"),
            (100, "–°–∫–æ–ª—å–∫–æ –ø–µ—Ä–∏–æ–¥–æ–≤ –≤ —Ö–æ–∫–∫–µ–µ?", "3"),
            (100, "–ö–∞–∫–æ–π —Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Å–ø–æ—Ä—Ç –≤ –º–∏—Ä–µ?", "–§—É—Ç–±–æ–ª"),
            
            # 200 –æ—á–∫–æ–≤
            (200, "–°–∫–æ–ª—å–∫–æ –∫–æ–ª–µ—Ü –Ω–∞ –æ–ª–∏–º–ø–∏–π—Å–∫–æ–º —Ñ–ª–∞–≥–µ?", "5"),
            (200, "–ö–∞–∫–æ–π —Ä–æ—Å—Ç —É –±–∞—Å–∫–µ—Ç–±–æ–ª—å–Ω–æ–≥–æ –∫–æ–ª—å—Ü–∞?", "3.05"),
            (200, "–°–∫–æ–ª—å–∫–æ –≤–µ—Å–∏—Ç —Ñ—É—Ç–±–æ–ª—å–Ω—ã–π –º—è—á?", "450"),
            (200, "–ö—Ç–æ –∏–∑–æ–±—Ä–µ–ª –±–∞—Å–∫–µ—Ç–±–æ–ª?", "–ù–µ–π—Å–º–∏—Ç"),
            (200, "–°–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ –≤–æ–ª–µ–π–±–æ–ª–µ?", "6"),
            
            # 300 –æ—á–∫–æ–≤
            (300, "–ö–∞–∫–æ–π —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –≤–∏–¥ —Å–ø–æ—Ä—Ç–∞?", "–§–æ—Ä–º—É–ª–∞-1"),
            (300, "–°–∫–æ–ª—å–∫–æ –æ—á–∫–æ–≤ –∑–∞ –≥–æ–ª –≤ —Ä–µ–≥–±–∏?", "5"),
            (300, "–ö–∞–∫–æ–π —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π —Å–ø–æ—Ä—Ç—Å–º–µ–Ω?", "–í–æ–ª–µ–π–±–æ–ª"),
            (300, "–°–∫–æ–ª—å–∫–æ —Ä–∞—É–Ω–¥–æ–≤ –≤ –±–æ–∫—Å–µ?", "12"),
            (300, "–ö–∞–∫–æ–π —Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π –≤–∏–¥ —Å–ø–æ—Ä—Ç–∞?", "–ë–µ–≥"),
            
            # 400 –æ—á–∫–æ–≤
            (400, "–°–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –Ω–∞ –∞—Ç–∞–∫—É –≤ –±–∞—Å–∫–µ—Ç–±–æ–ª–µ?", "24"),
            (400, "–ö–∞–∫–æ–π –≤–µ—Å —à—Ç–∞–Ω–≥–∏ –≤ —Ç—è–∂–µ–ª–æ–π –∞—Ç–ª–µ—Ç–∏–∫–µ?", "–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–π"),
            (400, "–°–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ –±–µ–π—Å–±–æ–ª–µ?", "9"),
            (400, "–ö–∞–∫–æ–π —Å–∞–º—ã–π –¥–ª–∏–Ω–Ω—ã–π –º–∞—Ä–∞—Ñ–æ–Ω?", "90 –∫–º"),
            (400, "–°–∫–æ–ª—å–∫–æ –∑–∞–º–µ–Ω –≤ —Ñ—É—Ç–±–æ–ª–µ?", "3"),
            
            # 500 –æ—á–∫–æ–≤
            (500, "–ö—Ç–æ –≤—ã–∏–≥—Ä–∞–ª –ß–ú –ø–æ —Ñ—É—Ç–±–æ–ª—É 2018?", "–§—Ä–∞–Ω—Ü–∏—è"),
            (500, "–°–∫–æ–ª—å–∫–æ –∑–æ–ª–æ—Ç—ã—Ö –º–µ–¥–∞–ª–µ–π —É –§–µ–ª–ø—Å–∞?", "23"),
            (500, "–ö—Ç–æ —Å–∞–º—ã–π —Ç–∏—Ç—É–ª–æ–≤–∞–Ω–Ω—ã–π —Ñ—É—Ç–±–æ–ª–∏—Å—Ç?", "–ú–µ—Å—Å–∏"),
            (500, "–°–∫–æ–ª—å–∫–æ –∫–º –≤ –º–∞—Ä–∞—Ñ–æ–Ω–µ?", "42.195"),
            (500, "–ö—Ç–æ –ø—Ä–∏–¥—É–º–∞–ª –≤–æ–ª–µ–π–±–æ–ª?", "–ú–æ—Ä–≥–∞–Ω"),
        ]
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å—ã –≤ –±–∞–∑—É
        for points, question_text, answer in initial_questions:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –≤–æ–ø—Ä–æ—Å
            exists = session.query(Question).filter_by(
                points=points, 
                question_text=question_text
            ).first()
            
            if not exists:
                question = Question(
                    points=points,
                    question_text=question_text,
                    answer=answer
                )
                session.add(question)
        
        session.commit()
        
        # –°—á–∏—Ç–∞–µ–º —Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–ª–æ –≤–æ–ø—Ä–æ—Å–æ–≤
        new_count = session.query(Question).count()
        print(f"‚úÖ –¢–µ–ø–µ—Ä—å –≤ –±–∞–∑–µ {new_count} –≤–æ–ø—Ä–æ—Å–æ–≤!")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤: {e}")
    finally:
        session.close()

# ===== –†–∞–±–æ—Ç–∞ —Å –∏–≥—Ä–æ–≤—ã–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º =====
async def get_game_progress(user_id: int, game_session: str):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–≥—Ä—ã"""
    session = Session()
    try:
        progress = session.query(GameProgress).filter(
            GameProgress.user_id == user_id,
            GameProgress.game_session == game_session
        ).all()
        return progress
    finally:
        session.close()

async def update_game_progress(user_id: int, question_id: int, status: str, game_session: str):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–≥—Ä—ã"""
    session = Session()
    try:
        progress = GameProgress(
            user_id=user_id,
            question_id=question_id,
            status=status,
            game_session=game_session
        )
        session.add(progress)
        session.commit()
        return progress
    finally:
        session.close()